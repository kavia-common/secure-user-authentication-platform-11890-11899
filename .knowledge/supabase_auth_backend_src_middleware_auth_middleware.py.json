{"is_source_file": true, "format": "Python", "description": "This file defines an authentication middleware class for FastAPI, handling token validation, session management, email verification, and 2FA requirements. It interacts with external services for session and JWT validation, and provides dependency functions for route protection.", "external_files": ["src/services/session_service", "src/services/jwt_service"], "external_methods": ["session_service.validate_session", "session_service.extend_session", "jwt_service.verify_token"], "published": ["get_current_user", "get_current_verified_user", "get_current_2fa_user"], "classes": [{"name": "AuthMiddleware", "description": "Middleware class to handle authentication, session validation, email verification, and 2FA checks within FastAPI."}], "methods": [{"name": "Dict[str,Any] get_current_user(self, credentials: HTTPAuthorizationCredentials)", "description": "Retrieve current user info from an authorization header token, validating session and JWT, and extending session.", "scope": "AuthMiddleware", "scopeKind": "class"}, {"name": "Optional[Dict[str,Any]] get_optional_current_user(self, request: Request)", "description": "Attempt to retrieve user info from a request header without throwing exceptions if invalid or absent.", "scope": "AuthMiddleware", "scopeKind": "class"}, {"name": "Dict[str,Any] require_verified_email(self, current_user: Dict[str, Any])", "description": "Ensure the user's email is verified; raise HTTPException if not.", "scope": "AuthMiddleware", "scopeKind": "class"}, {"name": "Dict[str,Any] require_2fa_completed(self, current_user: Dict[str, Any])", "description": "Ensure the user has completed 2FA; raise HTTPException if not.", "scope": "AuthMiddleware", "scopeKind": "class"}, {"name": "__init__(self)", "scope": "AuthMiddleware", "scopeKind": "class", "description": "unavailable"}, {"name": "Dict[str,Any] get_current_2fa_user(current_user: Dict[str, Any] = get_current_verified_user)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,Any] get_current_user(credentials: HTTPAuthorizationCredentials = security)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,Any] get_current_verified_user(current_user: Dict[str, Any] = get_current_user)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["session_service.validate_session", "session_service.extend_session", "jwt_service.verify_token"], "search-terms": ["AuthMiddleware", "get_current_user", "session_service", "jwt_service", "FastAPI dependencies", "token validation", "session management", "email verification", "2FA"], "state": 2, "file_id": 14, "knowledge_revision": 73, "git_revision": "6ad20ab69f3fbc943e47aacf4d49fc9b4afde8e7", "revision_history": [{"29": ""}, {"73": "6ad20ab69f3fbc943e47aacf4d49fc9b4afde8e7"}], "ctags": [{"_type": "tag", "name": "AuthMiddleware", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^class AuthMiddleware:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^    def __init__(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "AuthMiddleware", "scopeKind": "class"}, {"_type": "tag", "name": "auth_middleware", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^auth_middleware = AuthMiddleware()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "get_current_2fa_user", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^async def get_current_2fa_user(current_user: Dict[str, Any] = get_current_verified_user) -> Dict/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(current_user: Dict[str, Any] = get_current_verified_user)"}, {"_type": "tag", "name": "get_current_user", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^    async def get_current_user(self, credentials: HTTPAuthorizationCredentials) -> Dict[str, Any/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "member", "signature": "(self, credentials: HTTPAuthorizationCredentials)", "scope": "AuthMiddleware", "scopeKind": "class"}, {"_type": "tag", "name": "get_current_user", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^async def get_current_user(credentials: HTTPAuthorizationCredentials = security) -> Dict[str, An/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(credentials: HTTPAuthorizationCredentials = security)"}, {"_type": "tag", "name": "get_current_verified_user", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^async def get_current_verified_user(current_user: Dict[str, Any] = get_current_user) -> Dict[str/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(current_user: Dict[str, Any] = get_current_user)"}, {"_type": "tag", "name": "get_optional_current_user", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^    async def get_optional_current_user(self, request: Request) -> Optional[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,Any]]", "kind": "member", "signature": "(self, request: Request)", "scope": "AuthMiddleware", "scopeKind": "class"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^logger = logging.getLogger(__name__)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "require_2fa_completed", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^    async def require_2fa_completed(self, current_user: Dict[str, Any]) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "member", "signature": "(self, current_user: Dict[str, Any])", "scope": "AuthMiddleware", "scopeKind": "class"}, {"_type": "tag", "name": "require_verified_email", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^    async def require_verified_email(self, current_user: Dict[str, Any]) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "member", "signature": "(self, current_user: Dict[str, Any])", "scope": "AuthMiddleware", "scopeKind": "class"}, {"_type": "tag", "name": "security", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^security = HTTPBearer()$/", "language": "Python", "kind": "variable"}], "hash": "8520a032b5bfe5bd6c02850e747b6c8d", "format-version": 4, "code-base-name": "supabase_auth_backend", "filename": "supabase_auth_backend/src/middleware/auth_middleware.py", "fields": [{"name": "auth_middleware = AuthMiddleware()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logger = logging.getLogger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "security = HTTPBearer()", "scope": "", "scopeKind": "", "description": "unavailable"}]}