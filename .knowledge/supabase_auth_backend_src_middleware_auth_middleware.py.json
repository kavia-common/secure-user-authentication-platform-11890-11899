{"is_source_file": true, "format": "Python", "description": "This file implements an authentication middleware for a FastAPI application. It handles session validation, JWT verification, and user authorization checks such as email verification and 2FA completion. It provides dependency functions for request handling and defines a middleware class encapsulating core logic.", "external_files": ["src/services/session_service", "src/services/jwt_service"], "external_methods": ["session_service.validate_session", "session_service.extend_session", "jwt_service.verify_token"], "published": ["get_current_user", "get_current_verified_user", "get_current_2fa_user"], "classes": [{"name": "AuthMiddleware", "description": "Middleware class for handling user authentication, session validation, and authorization checks."}], "methods": [{"name": "Dict[str,Any] get_current_user(self, credentials: HTTPAuthorizationCredentials)", "description": "Retrieve the current user based on the provided authorization credentials, validating session and JWT token.", "scope": "AuthMiddleware", "scopeKind": "class"}, {"name": "Optional[Dict[str,Any]] get_optional_current_user(self, request: Request)", "description": "Retrieve the current user from the request headers if a valid token is present; returns None otherwise.", "scope": "AuthMiddleware", "scopeKind": "class"}, {"name": "Dict[str,Any] require_verified_email(self, current_user: Dict[str, Any])", "description": "Ensure the user has a verified email address; raises an exception if not verified.", "scope": "AuthMiddleware", "scopeKind": "class"}, {"name": "Dict[str,Any] require_2fa_completed(self, current_user: Dict[str, Any])", "description": "Ensure the user has completed two-factor authentication; raises an exception if not.", "scope": "AuthMiddleware", "scopeKind": "class"}, {"name": "__init__(self)", "scope": "AuthMiddleware", "scopeKind": "class", "description": "unavailable"}, {"name": "Dict[str,Any] get_current_2fa_user(current_user: Dict[str, Any] = get_current_verified_user)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,Any] get_current_user(credentials: HTTPAuthorizationCredentials = security)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "Dict[str,Any] get_current_verified_user(current_user: Dict[str, Any] = get_current_user)", "scope": "", "scopeKind": "", "description": "unavailable"}], "calls": ["session_service.validate_session", "session_service.extend_session", "jwt_service.verify_token"], "search-terms": ["auth_middleware", "FastAPI authentication", "session validation", "JWT verification", "verification checks", "middleware class"], "state": 2, "file_id": 14, "knowledge_revision": 29, "git_revision": "", "ctags": [{"_type": "tag", "name": "AuthMiddleware", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^class AuthMiddleware:$/", "language": "Python", "kind": "class"}, {"_type": "tag", "name": "__init__", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^    def __init__(self):$/", "language": "Python", "kind": "member", "signature": "(self)", "scope": "AuthMiddleware", "scopeKind": "class"}, {"_type": "tag", "name": "auth_middleware", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^auth_middleware = AuthMiddleware()$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "get_current_2fa_user", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^async def get_current_2fa_user(current_user: Dict[str, Any] = get_current_verified_user) -> Dict/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(current_user: Dict[str, Any] = get_current_verified_user)"}, {"_type": "tag", "name": "get_current_user", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^    async def get_current_user(self, credentials: HTTPAuthorizationCredentials) -> Dict[str, Any/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "member", "signature": "(self, credentials: HTTPAuthorizationCredentials)", "scope": "AuthMiddleware", "scopeKind": "class"}, {"_type": "tag", "name": "get_current_user", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^async def get_current_user(credentials: HTTPAuthorizationCredentials = security) -> Dict[str, An/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(credentials: HTTPAuthorizationCredentials = security)"}, {"_type": "tag", "name": "get_current_verified_user", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^async def get_current_verified_user(current_user: Dict[str, Any] = get_current_user) -> Dict[str/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "function", "signature": "(current_user: Dict[str, Any] = get_current_user)"}, {"_type": "tag", "name": "get_optional_current_user", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^    async def get_optional_current_user(self, request: Request) -> Optional[Dict[str, Any]]:$/", "language": "Python", "typeref": "typename:Optional[Dict[str,Any]]", "kind": "member", "signature": "(self, request: Request)", "scope": "AuthMiddleware", "scopeKind": "class"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^logger = logging.getLogger(__name__)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "require_2fa_completed", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^    async def require_2fa_completed(self, current_user: Dict[str, Any]) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "member", "signature": "(self, current_user: Dict[str, Any])", "scope": "AuthMiddleware", "scopeKind": "class"}, {"_type": "tag", "name": "require_verified_email", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^    async def require_verified_email(self, current_user: Dict[str, Any]) -> Dict[str, Any]:$/", "language": "Python", "typeref": "typename:Dict[str,Any]", "kind": "member", "signature": "(self, current_user: Dict[str, Any])", "scope": "AuthMiddleware", "scopeKind": "class"}, {"_type": "tag", "name": "security", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/middleware/auth_middleware.py", "pattern": "/^security = HTTPBearer()$/", "language": "Python", "kind": "variable"}], "hash": "9c50fde396cc83df6d4513c4bec3842b", "format-version": 4, "code-base-name": "supabase_auth_backend", "filename": "supabase_auth_backend/src/middleware/auth_middleware.py", "fields": [{"name": "auth_middleware = AuthMiddleware()", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logger = logging.getLogger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "security = HTTPBearer()", "scope": "", "scopeKind": "", "description": "unavailable"}], "revision_history": [{"29": ""}]}