{"is_source_file": true, "format": "Python", "description": "Main application file for a FastAPI-based backend providing user authentication, 2FA, profile management, and health checks. It sets up the FastAPI app, middleware, routers, WebSocket endpoints, and OpenAPI schema customization, along with startup and shutdown events.", "external_files": ["src.api.routes", "src.services.session_service", "src.config.settings", "src.services.jwt_service"], "external_methods": ["session_service.cleanup_expired_sessions", "session_service.get_session_info", "jwt_service.verify_token"], "published": ["app"], "classes": [], "methods": [{"name": "lifespan(app: FastAPI)", "description": "Async context manager for app startup and shutdown logging", "scope": "", "scopeKind": ""}, {"name": "add_process_time_header(request: Request, call_next)", "description": "Middleware to measure and add request processing time to headers", "scope": "", "scopeKind": ""}, {"name": "session_cleanup_middleware(request: Request, call_next)", "description": "Middleware to periodically clean up expired sessions", "scope": "", "scopeKind": ""}, {"name": "global_exception_handler(request: Request, exc: Exception)", "description": "Captures unhandled exceptions globally and returns a JSON error response", "scope": "", "scopeKind": ""}, {"name": "custom_openapi()", "description": "Generates a custom OpenAPI schema with security schemes and requirements", "scope": "", "scopeKind": ""}, {"name": "health_check()", "description": "Health check endpoint indicating if the backend is running", "scope": "", "scopeKind": ""}, {"name": "api_status()", "description": "API status endpoint providing system and session stats", "scope": "", "scopeKind": ""}, {"name": "websocket_endpoint(websocket)", "description": "WebSocket connection endpoint for real-time notifications and session monitoring", "scope": "", "scopeKind": ""}, {"name": "startup_event()", "description": "Event handler for app startup tasks", "scope": "", "scopeKind": ""}, {"name": "shutdown_event()", "description": "Event handler for app shutdown and cleanup tasks", "scope": "", "scopeKind": ""}], "calls": ["session_service.cleanup_expired_sessions", "session_service.get_session_info", "jwt_service.verify_token"], "search-terms": ["FastAPI", "auth_backend", "session_management", "WebSocket", "custom_openapi", "lifespan", "middleware", "health_check", "status_endpoint", "session_cleanup"], "state": 2, "file_id": 2, "knowledge_revision": 45, "git_revision": "f54078fe5c80d60133c119944791d13654a81026", "revision_history": [{"8": "f54078fe5c80d60133c119944791d13654a81026"}, {"42": "f54078fe5c80d60133c119944791d13654a81026"}, {"45": "f54078fe5c80d60133c119944791d13654a81026"}], "ctags": [{"_type": "tag", "name": "add_process_time_header", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/api/main.py", "pattern": "/^async def add_process_time_header(request: Request, call_next):$/", "language": "Python", "kind": "function", "signature": "(request: Request, call_next)"}, {"_type": "tag", "name": "api_status", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/api/main.py", "pattern": "/^async def api_status():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "app", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/api/main.py", "pattern": "/^app = FastAPI($/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "custom_openapi", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/api/main.py", "pattern": "/^def custom_openapi():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "global_exception_handler", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/api/main.py", "pattern": "/^async def global_exception_handler(request: Request, exc: Exception):$/", "language": "Python", "kind": "function", "signature": "(request: Request, exc: Exception)"}, {"_type": "tag", "name": "health_check", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/api/main.py", "pattern": "/^async def health_check():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "lifespan", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/api/main.py", "pattern": "/^async def lifespan(app: FastAPI):$/", "language": "Python", "kind": "function", "signature": "(app: FastAPI)"}, {"_type": "tag", "name": "logger", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/api/main.py", "pattern": "/^logger = logging.getLogger(__name__)$/", "language": "Python", "kind": "variable"}, {"_type": "tag", "name": "session_cleanup_middleware", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/api/main.py", "pattern": "/^async def session_cleanup_middleware(request: Request, call_next):$/", "language": "Python", "kind": "function", "signature": "(request: Request, call_next)"}, {"_type": "tag", "name": "shutdown_event", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/api/main.py", "pattern": "/^async def shutdown_event():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "startup_event", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/api/main.py", "pattern": "/^async def startup_event():$/", "language": "Python", "kind": "function", "signature": "()"}, {"_type": "tag", "name": "websocket_endpoint", "path": "/home/kavia/workspace/code-generation/secure-user-authentication-platform-11890-11899/supabase_auth_backend/src/api/main.py", "pattern": "/^async def websocket_endpoint(websocket):$/", "language": "Python", "kind": "function", "signature": "(websocket)"}], "hash": "ef9e661ef8ba7b536a0d6eb19b90d5a3", "format-version": 4, "code-base-name": "supabase_auth_backend", "filename": "supabase_auth_backend/src/api/main.py", "fields": [{"name": "app = FastAPI(", "scope": "", "scopeKind": "", "description": "unavailable"}, {"name": "logger = logging.getLogger(__name__)", "scope": "", "scopeKind": "", "description": "unavailable"}]}